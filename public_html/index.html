<!DOCTYPE html>

<html>
    <head>
        <title>Microblog utenti</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style/css/bootstrap.min.css">
        <script>
            function showList(address) {
                var loader = '<button class="btn btn-primary" disabled><span class="spinner-border spinner-border-sm"></span>&nbsp Attendere...</button>'
                document.getElementById("risultato-raw").innerHTML = "";
                document.getElementById("risultato").innerHTML = "starting..";

                if (window.XMLHttpRequest) {
                    // code for IE7+, Firefox, Chrome, Opera, Safari
                    xmlhttp = new XMLHttpRequest();
                } else {  // code for IE6, IE5
                    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                }

                xmlhttp.onreadystatechange = function () {

                    if (this.readyState === 4 && this.status === 200) {
                        visualJson(this.responseText);

                    } else
                        document.getElementById("risultato").innerHTML = loader;

                }
                xmlhttp.open("GET", address, true);
                xmlhttp.send();
            }

            function visualJson(json) {
                //var deb = alert(json); //debugger
                //var deb_ = alert(JSON.parse(json)); //debugger
                if (json[40] === 'a') {
                    
                    var parsedJson = JSON.parse(json);
                    var output = '<div> HTTP responce code: ' + parsedJson.server + "</div><br>";
                    var table = '<table class="table"><thead class="thead-dark"><tr><th scope="col">Id</th><th scope="col">Username</th><th scope="col">Email</th><th scope="col">Password</th></tr></thead>';
                    for (i = 0; i < parsedJson.response.length; i++) {
                        table += "<tr><td>" +
                                parsedJson.response[i].id + "</td></th><td>" +
                                parsedJson.response[i].username + "</td><td>" +
                                parsedJson.response[i].email + "</td><td>" +
                                parsedJson.response[i].password + "</td></tr>";
                    }
                    table += "</table>";
                    document.getElementById("risultato").innerHTML = output + table;
                } else if (json[40] === '"') {
                    var parsedJson = JSON.parse(json);
                    var output = '<div> HTTP responce code: ' + parsedJson.server + "</div><br>";
                    var table = '<table class="table"><thead class="thead-dark"><tr><th scope="col">Id</th><th scope="col">Title</th><th scope="col">Content</th><th scope="col">Autore</th></tr></thead>';
                    for (i = 0; i < parsedJson.response.length; i++) {
                        table += "<tr><td>" +
                                parsedJson.response[i].id + "</td></th><td>" +
                                parsedJson.response[i].title + "</td><td>" +
                                parsedJson.response[i].content + "</td><td>" +
                                parsedJson.response[i].user.username + "</td>";
                    }
                    table += "</table>";
                    document.getElementById("risultato").innerHTML = output + table;
                } else if (json[40] === 'C') {
                    var parsedJson = JSON.parse(json);
                    var output = '<div> HTTP responce code: ' + parsedJson.server + "</div><br>";
                    var table = '<table class="table"><thead class="thead-dark"><tr><th scope="col">Id</th><th scope="col">Title</th><th scope="col">Content</th><th scope="col">Post</th><th scope="col">Autore</th></tr></thead>';
                    for (i = 0; i < parsedJson.response.length; i++) {
                        table += "<tr><td>" +
                                parsedJson.response[i].id + "</td></th><td>" +
                                parsedJson.response[i].titleC + "</td><td>" +
                                parsedJson.response[i].content + "</td><td>" +
                                parsedJson.response[i].post.title + "</td><td>" +
                                parsedJson.response[i].user.username + "</td>";
                    }
                    table += "</table>";
                    document.getElementById("risultato").innerHTML = output + table;
                }
            }

        </script>

    </head>
    <body>
        <div class="container py-5">
            <ul class="nav nav-fill">
                <a class="nav-item"><h1>WELLCOME</h1></a>
            </ul><br><br>
            <ul class="nav nav-fill">
                <a class="nav-item" href="user.html"><h2>USER</h2></a>
                <a class="nav-item" href="post.html"><h2>POST</h2></a>
                <a class="nav-item" href="comment.html"><h2>COMMENT</h2></a>
                <a class="nav-item"><input type="button" class="btn btn-info btn-lg" value="List of users" onClick="showList('http://localhost:8084/api/users')"></a>
                <a class="nav-item"><input type="button" class="btn btn-info btn-lg" value="List of posts" onClick="showList('http://localhost:8084/api/posts')"></a>
                <a class="nav-item"><input type="button" class="btn btn-info btn-lg" value="List of comments" onClick="showList('http://localhost:8084/api/comments')"></a>
            </ul><br> 

            <div id="risultato-raw"></div>
            <hr>
            <div id="risultato"></div>
            <script src="style/jquery-3.5.1.min.js"></script>
            <script src="style/js/bootstrap.min.js"></script>
        </div>
    </body>
</html>